<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Editar perfil</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="form-wrapper">
    <form [formGroup]="profileForm" (ngSubmit)="onSubmit()">

      <ion-list lines="none">
        <!-- Nombre y Apellido -->
        <div class="contenedor fila">
          <ion-item class="item-flex">
            <ion-label position="floating">Nombre</ion-label>
            <ion-input formControlName="name"></ion-input>
          </ion-item>
          <ion-item class="item-flex">
            <ion-label position="floating">Apellido</ion-label>
            <ion-input formControlName="lastName"></ion-input>
          </ion-item>
        </div>

        <!-- Correo -->
        <ion-item>
          <ion-label position="floating">Correo electrónico</ion-label>
          <ion-input formControlName="email" type="email"></ion-input>
        </ion-item>
        <ion-text color="danger" *ngIf="email?.invalid && (email?.touched || email?.dirty)">
          <div *ngIf="email?.errors?.['required']">Este campo es obligatorio.</div>
          <div *ngIf="email?.errors?.['email']">Formato de correo inválido.</div>
        </ion-text>

        <!-- Contraseña -->
        <ion-item>
          <ion-label position="floating">Nueva contraseña</ion-label>
          <ion-input
            formControlName="passwordRaw"
            type="password"
            placeholder="(Deja vacío para no cambiar)"
          ></ion-input>
        </ion-item>

        <!-- Confirmar contraseña -->
        <ion-item>
          <ion-label position="floating">Confirmar contraseña</ion-label>
          <ion-input
            formControlName="confirmPassword"
            type="password"
            placeholder="(Deja vacío para no cambiar)"
          ></ion-input>
        </ion-item>
        <ion-text
          color="danger"
          *ngIf="profileForm.hasError('passwordMismatch') && (confirmPassword?.touched || confirmPassword?.dirty)"
        >
          Las contraseñas no coinciden.
        </ion-text>

        <!-- País -->
        <div class="contenedorlbl">
          <ion-label>Busca tu país</ion-label>
          <ion-label>Selecciona tu país</ion-label>
        </div>
        <div class="contenedor fila">
          <ion-item class="item-flex">
            <ion-searchbar
              [(ngModel)]="countrySearch"
              [ngModelOptions]="{ standalone: true }"
              placeholder="EJ: Col"
              debounce="300"
              (ionInput)="filterCountries()"
              showCancelButton="focus"
            ></ion-searchbar>
          </ion-item>

          <ion-item class="item-flex">
            <ion-select formControlName="country" interface="popover">
              <ion-select-option *ngFor="let c of filteredCountries" [value]="c">
                <img
                  [src]="c.flagUrl"
                  width="24"
                  height="18"
                  style="margin-right: 8px"
                />
                {{ c.name }}
              </ion-select-option>
            </ion-select>
          </ion-item>
        </div>
      </ion-list>

      <!-- Botones -->
      <div class="button-group">
        <ion-button
          fill="outline"
          color="medium"
          type="button"
          (click)="onCancel()"
        >
          Cancelar
        </ion-button>
        <ion-button
          expand="block"
          type="submit"
          [disabled]="profileForm.invalid"
          color="success"
        >
          Guardar cambios
        </ion-button>
      </div>

    </form>
  </div>
</ion-content>